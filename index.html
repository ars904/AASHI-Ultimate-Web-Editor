<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AASHI Ultimate Web Editor</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #1e1e1e;
      color: white;
      display: flex;
      height: 100vh;
    }

    header {
      padding: 10px 20px;
      background-color: #151515;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #333;
    }

    .buttons {
      display: flex;
      gap: 10px;
    }

    button, label.file-btn {
      background-color: #444;
      color: white;
      border: none;
      padding: 6px 12px;
      cursor: pointer;
      border-radius: 4px;
      font-size: 14px;
    }

    input[type="file"] {
      display: none;
    }

    .container {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    .file-explorer {
      width: 300px;
      background-color: #2d2d2d;
      border-right: 1px solid #444;
      overflow-y: auto;
      padding: 10px;
    }

    .file-explorer ul {
      list-style-type: none;
      padding-left: 0;
    }

    .file-explorer li {
      padding: 5px;
      cursor: pointer;
      margin-bottom: 5px;
      background-color: #444;
      border-radius: 4px;
    }

    .file-explorer li:hover {
      background-color: #555;
    }

    .file-preview {
      margin-top: 10px;
    }

    .file-preview img {
      width: 100px;
      height: auto;
    }

    .file-preview audio {
      width: 100%;
    }

    .editor-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      border-right: 1px solid #444;
      background-color: #2d2d2d;
    }

    .tabs {
      display: flex;
      background-color: #1e1e1e;
      border-bottom: 1px solid #333;
    }

    .tab {
      flex: 1;
      text-align: center;
      padding: 10px;
      cursor: pointer;
      font-weight: bold;
      background-color: #1e1e1e;
      border-bottom: 3px solid transparent;
    }

    .tab.active {
      border-bottom: 3px solid #00bfff;
      background-color: #2d2d2d;
    }

    .editor {
      flex: 1;
      display: none;
    }

    .editor.active {
      display: block;
    }

    textarea {
      width: 100%;
      height: 100%;
      background-color: #2d2d2d;
      color: white;
      border: none;
      font-family: monospace;
      font-size: 14px;
      padding: 10px;
      outline: none;
      resize: none;
    }

    iframe {
      flex: 1;
      border: none;
      background: white;
    }

    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }

      iframe {
        height: 50vh;
        width: 100%;
      }

      .editor-section {
        height: 50vh;
        border-right: none;
      }

      .file-explorer {
        width: 100%;
        height: 150px;
        overflow-y: auto;
      }
    }
  </style>
</head>
<body>

  <header>
    <div class="buttons">
      <label class="file-btn">
        Open Folder
        <input type="file" id="fileInput" multiple webkitdirectory>
      </label>
      <button onclick="run()">Run</button>
      <button onclick="clearCode()">Clear</button>
      <button onclick="downloadProject()">Download</button>
    </div>
  </header>

  <div class="container">
    <!-- File Explorer -->
    <div class="file-explorer">
      <ul id="fileList"></ul>
    </div>

    <!-- Editor Section -->
    <div class="editor-section">
      <div class="tabs">
        <div class="tab active" onclick="switchTab('html')">HTML</div>
        <div class="tab" onclick="switchTab('css')">CSS</div>
        <div class="tab" onclick="switchTab('js')">JS</div>
      </div>

      <div id="html" class="editor active">
        <textarea id="htmlEditor"></textarea>
      </div>
      <div id="css" class="editor">
        <textarea id="cssEditor"></textarea>
      </div>
      <div id="js" class="editor">
        <textarea id="jsEditor"></textarea>
      </div>
    </div>

    <!-- Output Preview -->
    <iframe id="output"></iframe>
  </div>

  <script>
    const htmlEl = document.getElementById('htmlEditor');
    const cssEl = document.getElementById('cssEditor');
    const jsEl = document.getElementById('jsEditor');
    const output = document.getElementById('output');
    const fileInput = document.getElementById('fileInput');
    const fileList = document.getElementById('fileList');

    let files = {};

    // Restore code from localStorage
    htmlEl.value = localStorage.getItem("html") || "";
    cssEl.value = localStorage.getItem("css") || "";
    jsEl.value = localStorage.getItem("js") || "";

    function run() {
      const html = htmlEl.value;
      const css = `<style>${cssEl.value}</style>`;
      const js = `<script>${jsEl.value}<\/script>`;
      const doc = output.contentDocument || output.contentWindow.document;
      doc.open();
      doc.write(html + css + js);
      doc.close();

      // Save to localStorage
      localStorage.setItem("html", html);
      localStorage.setItem("css", cssEl.value);
      localStorage.setItem("js", jsEl.value);
    }

    function clearCode() {
      htmlEl.value = "";
      cssEl.value = "";
      jsEl.value = "";
      localStorage.clear();
      run();
      
      // Clear the file explorer
      fileList.innerHTML = '';
    }

    function switchTab(tabId) {
      document.querySelectorAll('.editor').forEach(e => e.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(e => e.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
      document.querySelector(`.tab[onclick="switchTab('${tabId}')"]`).classList.add('active');
    }

    fileInput.addEventListener('change', async (event) => {
      const filesArray = event.target.files;
      files = {};
      fileList.innerHTML = ''; // Clear the current list

      for (let file of filesArray) {
        const content = await file.text();
        if (file.name.endsWith('.html')) {
          htmlEl.value = content;
          localStorage.setItem("html", content);
        } else if (file.name.endsWith('.css')) {
          cssEl.value = content;
          localStorage.setItem("css", content);
        } else if (file.name.endsWith('.js')) {
          jsEl.value = content;
          localStorage.setItem("js", content);
        } else {
          const blobUrl = URL.createObjectURL(file);
          files[file.name] = blobUrl;
          renderFile(file);
        }
      }
      run();
    });

    function renderFile(file) {
      const li = document.createElement('li');
      li.textContent = file.name;
      li.onclick = () => previewFile(file);
      fileList.appendChild(li);
    }

    function previewFile(file) {
      const filePreview = document.querySelector('.file-preview');
      if (!filePreview) {
        const previewContainer = document.createElement('div');
        previewContainer.classList.add('file-preview');
        document.querySelector('.file-explorer').appendChild(previewContainer);
      }

      const filePreviewContainer = document.querySelector('.file-preview');
      filePreviewContainer.innerHTML = ''; // Clear previous preview

      if (file.name.endsWith('.jpg') || file.name.endsWith('.png') || file.name.endsWith('.gif')) {
        const img = document.createElement('img');
        img.src = files[file.name];
        filePreviewContainer.appendChild(img);
      } else if (file.name.endsWith('.mp3') || file.name.endsWith('.wav')) {
        const audio = document.createElement('audio');
        audio.controls = true;
        audio.src = files[file.name];
        filePreviewContainer.appendChild(audio);
      }
    }

    function downloadProject() {
      const zip = new JSZip();
      zip.file("index.html", htmlEl.value);
      zip.file("style.css", cssEl.value);
      zip.file("script.js", jsEl.value);

      Object.keys(files).forEach(filename => {
        const fileBlob = files[filename];
        fetch(fileBlob).then(res => res.blob())
          .then(blob => {
            zip.file(filename, blob);
          });
      });

      zip.generateAsync({ type: "blob" }).then(function(content) {
        const link = document.createElement("a");
        link.href = URL.createObjectURL(content);
        link.download = "project.zip";
        link.click();
      });
    }

    run();  // Initialize first render
  </script>
  
  <!-- Include JSZip library for downloading the project as a zip file -->
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.7.1/dist/jszip.min.js"></script>

</body>
</html>
